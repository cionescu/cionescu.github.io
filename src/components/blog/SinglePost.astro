---
import Image from '~/components/common/Image.astro';
import { getFormattedDate } from '~/utils/utils';

import type { Post } from '~/types';

export interface Props {
  post: Post;
  url: string | URL;
}

const { post, url } = Astro.props;
const { Content } = post;
---

<header class="mb-10">
  <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight mb-6 leading-tight">{post.title}</h1>

  <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 mb-8">
    <div class="flex items-center gap-1.5">
      <span class="inline-flex">
        <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8 7V3M16 7V3M4 11H20M5 6H19C20.1046 6 21 6.89543 21 8V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V8C3 6.89543 3.89543 6 5 6Z" />
        </svg>
      </span>
      <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
    </div>
    {post.readingTime && (
      <div class="flex items-center gap-1.5">
        <span class="inline-flex">
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 8V12L15 15" />
            <circle cx="12" cy="12" r="9" />
          </svg>
        </span>
        <span>{post.readingTime} min read</span>
      </div>
    )}

    {post.tags && post.tags.length > 0 && (
      <div class="flex items-center gap-2">
        {post.tags.slice(0, 2).map((tag, idx) => (
          <span
            class:list={[
              'px-2.5 py-0.5 rounded-full font-medium text-xs',
              idx % 2 === 0 ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700',
            ]}
          >
            {tag}
          </span>
        ))}
      </div>
    )}
  </div>

  {post.excerpt && (
    <p class="lead text-xl text-gray-600 mb-8 leading-relaxed">{post.excerpt}</p>
  )}

  {post.image && (
    <div class="my-8">
      <Image
        src={post.image}
        class="w-full h-auto rounded-lg shadow-sm"
        widths={[400, 900, 1600]}
        sizes="(max-width: 1023px) 100vw, 900px"
        alt={post?.excerpt || post.title}
        width={1600}
        height={900}
        loading="eager"
        decoding="async"
      />
    </div>
  )}
</header>

<div class="prose prose-lg prose-slate max-w-none text-gray-800 prose-headings:scroll-mt-24 prose-a:text-accent-blue prose-img:rounded-lg prose-img:shadow-sm prose-li:marker:text-accent-orange" data-toc-content>
  {Content ? <Content /> : <Fragment set:html={post.content || ''} />}
</div>

<div class="mt-16 bg-gray-900 rounded-2xl p-8 md:p-10 text-white relative overflow-hidden">
  <div class="absolute top-0 right-0 w-64 h-64 bg-accent-orange opacity-10 rounded-full transform translate-x-1/3 -translate-y-1/3 blur-3xl"></div>

  <div class="relative z-10">
    <h3 class="text-2xl font-bold mb-3">Enjoyed this article?</h3>
    <p class="text-gray-300 mb-6 max-w-xl">
      Join 12,000+ engineers and leaders who get my best content on engineering leadership, AI, and system design
      delivered to their inbox bi-weekly.
    </p>

    <form class="flex flex-col sm:flex-row gap-3 max-w-md" action="#" method="post">
      <input
        type="email"
        placeholder="email@example.com"
        class="flex-grow px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent-orange"
        required
      />
      <button type="submit" class="px-6 py-3 bg-accent-orange text-white font-bold rounded-lg hover:bg-orange-600 transition-colors">
        Subscribe
      </button>
    </form>
    <p class="text-xs text-gray-500 mt-3">No spam, unsubscribe anytime.</p>
  </div>
</div>

<div class="mt-12 pt-8 border-t border-gray-200 flex flex-wrap gap-4 justify-between items-center">
  <div class="flex gap-4">
    <button class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition-colors" type="button">
      <span class="inline-flex">
        <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M7 10V20M7 20H4V10H7ZM20 10C20 8.89543 19.1046 8 18 8H13L14 4.5C14.2761 3.67157 13.3284 2.72386 12.5 3L7 8.5V20H17.035C17.9765 20 18.778 19.3394 18.956 18.4145L19.956 13.4145C19.986 13.2647 20 13.1122 20 12.959V10Z" />
        </svg>
      </span>
      <span class="text-sm font-medium">Helpful</span>
    </button>
    <button class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition-colors" type="button">
      <span class="inline-flex">
        <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z" />
        </svg>
      </span>
      <span class="text-sm font-medium">Discuss</span>
    </button>
  </div>

  <div class="flex items-center gap-3 text-sm text-gray-500">
    <span>Share this article:</span>
    <button class="p-2 hover:text-accent-orange transition-colors" title="Twitter Share" data-aw-social-share="twitter" data-aw-url={url} data-aw-text={post.title}>
      <svg viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor" aria-hidden="true">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817-5.963 6.817H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
      </svg>
    </button>
    <button class="p-2 hover:text-accent-orange transition-colors" title="Share" data-aw-social-share="copy" data-aw-url={url} data-aw-text={post.title}>
      <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="5" r="3" />
        <circle cx="6" cy="12" r="3" />
        <circle cx="18" cy="19" r="3" />
        <path d="M8.59 13.51L15.42 17.49M15.41 6.51L8.59 10.49" />
      </svg>
    </button>
  </div>
</div>
